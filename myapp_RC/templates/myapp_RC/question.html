{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, device-height=device-height, initial-scale=1.0" >
    
    <title>Question Page</title>
    <link rel="stylesheet" type="text/css" href="{% static 'styles.css' %}"/>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="mycontainer">
      <nav class="navbar navbar-expand-lg navbar-light bg-light text-dark">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Navbar</a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Profile</a>
              </li>
  
              <li class="nav-item">
                <a class="nav-link" href ="{% url 'SignOut' %}">Log Out</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
  
      <!-- your code goes here -->

      {% for message in messages %} 
        <div class = "alert alert -{{ message.tags }} alert-dismissible fade show" role = "alert">
            <strong>Message:</strong> {{ message }}
                <button type = "button" class = "close" data-dismiss = "alert" aria-label = "Close">
                    <span aria-hidden = "true">×</span>
                </button>
        </div>
      {% endfor %}

      <div class="columns">
        <div class="column1">
          <div class="c13">
            <p rel="stylesheet" class="sec">SCORE : {{ profile.marks }}</p>
            <a rel="stylesheet" href="#" class="lb"><P class="ldr">LEADERBOARD</P></a>
          </div>
          <div class="c12">
            <p>LIFELINES</p>
            {% if profile.lifeline1_status %}
            <!-- sending get request for now-->
            <form>
            <!-- <form method="POST"> -->
              <a href="{% url 'lifeline1' %}" rel="stylesheet" class="l1" id="lifelinefirst">LIFELINE 1</a>
              <!-- <div id="myBar" class="w3-container w3-green" style="width:20%">{{profile.lifeline1_count}}</div> -->
              {% csrf_token %}
            </form>
            {% elif profile.lifeline1_postcount == 1 %}
            <form method="POST" action="{% url 'lifeline1' %}">
              <!-- <form method="POST"> -->
                <button type="submit" rel="stylesheet" class="l1" id="lifelinefirst">LIFELINE 1</button>
                <!-- <div id="myBar" class="w3-container w3-green" style="width:20%">{{profile.lifeline1_count}}</div> -->
                {% csrf_token %}
            </form>
            {% else %}
              <p rel="stylesheet" class="l0" id="lifelinefirst">LIFELINE 1</p>
            {% endif %}
            <div id="L1modal" class="modal_in">
              <!-- Modal content -->
              <div class="modal-content_in">
                <span class="close1">×</span>
                <p>This is details about first lifeline</p>
              </div>
            </div>
            <div rel="stylesheet" href="#" class="l2 action" id="lifelinesecond">
              <!-- <P>LIFELINE 2</P> -->
                <label>
                  {% if profile.lifeline2_status %}
                    <button id = "line2Checked" name = "line2Checked"disabled>Extra Time</button>
                  {% else %}
                    <input id = "line2Checked" name = "line2Checked" type = "checkbox"><span>Extra Time</span>
                  {% endif %}
                </label>
            </div>
            <div id="L2modal" class="modal_in">
              <!-- Modal content -->
              <div class="modal-content_in">
                <span class="close2">×</span>
                <p>This is details about second lifeline</p>
              </div>
            </div>
            <br>
            <a rel="stylesheet" href="#" class="l3" id="lifelinethird"><P>LIFELINE 3</P></a>
            <div id="L3modal" class="modal_in">
              <!-- Modal content -->
              <div class="modal-content_in">
                <span class="close3">×</span>
                <p>This is details about third lifeline</p>
              </div>
            </div>
          </div>
        </div>
      <div class="column2">
        <div class="c21">
          <div class="tr"><h1 class="trhead"><span id="time" class="t">XX : XX<p id="timer"></p></span></h1></div>
        </div>
        <form method="POST" action="{% url 'QuestionView1' %}" name="name1">

            {% csrf_token %}
          <div class="queshead">
            <h2 class="qh">Question No. {{ profile.quesno }}</h2>
          </div>
          
          <div class="question">
            <p>{{ currquest }}</p>
          </div>
          {% if profile.isFirstTry%}
            <div class="responses">
              <div class="opt1">
                Response 1 :
                <input type="number" name="res1" class="res1" id="res1" required>
              </div>
              <div class="opt2">
                Response 2 :
                <input type="number" name="res2" class="res2" id="res2" disabled>
              </div>
            </div>
            <div class="sub">
              <button type="submit" class="submit">Submit</button>
            </div>
            {% else %}
              <div class="responses">
                <div class="opt1">
                  Response 1 : {{ resp1 }}
                  <!-- <input type="number" name="res1" class="res1" id="res1" disabled> -->
                </div>
                <div class="opt2">
                  Response 2 :
                  <input type="number" name="res2" class="res2" id="res2" required>
                </div>
              </div>
              <div class="sub">
                <button type="submit" class="submit">Submit</button>
              </div>
              {% endif %}
      </div>
      <!-- Footer goes here -->
      <footer class="text-center fixed-bottom bg-light text-dark">
        <div class="container-fluid">
          <div class="footer-text pt-3 pb-4">PISB <span>&copy</span></div>
        </div>
      </footer>
       
      <script>
          // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];


        var lifelinefirst = document.getElementById("lifelinefirst");

        var lifelinesecond = document.getElementById("lifelinesecond")

        var lifelinethird = document.getElementById("lifelinethird")
        
        var L1modal = document.getElementById("L1modal")

        var L2modal = document.getElementById("L2modal")

        var L3modal = document.getElementById("L3modal")

        var span1 = document.getElementsByClassName("close1")[0];

        var span2 = document.getElementsByClassName("close2")[0];

        var span3 = document.getElementsByClassName("close3")[0];


        lifelinefirst.onclick = function() {
          L1modal.style.display = "block";
        }

        lifelinesecond.onclick = function() {
          L2modal.style.display = "block";
        }

        lifelinethird.onclick = function() {
          L3modal.style.display = "block";
        }

        // When the user clicks the button, open the modal 
        btn.onclick = function() {
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
          modal.style.display = "none";
        }

        span1.onclick = function() {
          L1modal.style.display = "none";
        }

        span2.onclick = function() {
          L2modal.style.display = "none";
        }

        span3.onclick = function() {
          L3modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
          if (event.target == modal) {
            modal.style.display = "none";
            L1modal.style.display = "none";
            L2modal.style.display = "none";
            L3modal.style.display = "none";
          }
        }
        
        const button = document.getElementById('myButton');

        //   setTimeout(function() {
        //   document.getElementById("line2Checked").disabled = true;
        //   element.parentNode.removeChild(element);
        // }, 3000);

          function countdown(seconds) {
            
            displayTime(seconds);
        
            
            var timer = setInterval(function() {
              seconds--;
              displayTime(seconds);
              if (seconds <= 0) {
                clearInterval(timer);
              }
            }, 1000);
        
            function displayTime(seconds) {
              
              var minutes = Math.floor(seconds / 60);
              var remainingSeconds = seconds % 60;
        
              
              var formattedTime = ('0' + minutes).slice(-2) + ':' + ('0' + remainingSeconds).slice(-2);
        
              document.getElementById('timer').textContent = formattedTime;
            }
          }
        
          countdown({{second1}}); 

        document.getElementById('line2Checked').addEventListener('change', function() {
          if (this.checked) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '{% url "lifeline2_ajax" %}', true);
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onreadystatechange = function() {
              if (this.readyState === 4 && this.status === 200) {
                var response = JSON.parse(this.responseText);
                console.log(response.message);
              }
            };
            var csrf_token = document.getElementsByName('csrfmiddlewaretoken')[0].value;
            xhr.send('csrfmiddlewaretoken=' + csrf_token + '&checkbox_value=true'); // Include CSRF token in POST data
          }
        });
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
      </script>
    </div>      
  </body>
</html>